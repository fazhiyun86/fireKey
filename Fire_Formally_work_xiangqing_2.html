<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<link rel="stylesheet" type="text/css" href="css/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="css/imageViewer.css" />
		<style>
			.Equipment_patrol_ccon2 {
				width: 100%;
				padding: 0.3rem 0;
				border-bottom: 1px solid #BBBBBB;
			}
			
			.Equipment_patrol_ccon2:last-child {
				border-bottom: 0!important;
			}
			
			.Equipment_patrol_ccon2 p {
				width: 100%;
				float: left;
				border-bottom: 1px solid #DCDCDC;
				white-space: normal!important;
				word-break: break-all;
			}
			
			.Equipment_patrol_ccon2 p span {
				white-space: normal;
				word-break: break-all;
			}
			
			.Equipment_patrol_ccon2_spanp>span {
				margin-left: 0;
			}
			
			.Equipment_patrol_ccon1 {
				padding: 0rem 0.3rem 0 0.3rem;
			}
			
			.Equipment_patrol_ccon1 i {
				padding-top: 2.5rem;
			}
			
			.Equipment_patrol_con1 div p {
				line-height: 1.5rem;
				padding: 0.3rem 0;
			}
			
			.Equipment_patrol_con1 {
				margin-top: 15px;
				padding: 0.5rem 0.3rem 0 0.5rem;
			}
			
			.Micro_task_pspan span:first-child {
				width: 72%;
				text-align: right;
			}
			
			.Micro_task_pspan span:nth-child(2) {
				width: 28%;
				padding-left: 0.3rem;
				text-align: left;
			}
			
			.Equipment_patrol_con1 div:first-child {
				padding-bottom: 0;
			}
			
			.Equipment_patrol_con1 div:first-child {
				width: 100%!important;
			}
		</style>
	</head>

	<body>
		<div class="mui-content Equipment_patrol_con">
			<div id="Equipment_patrol_con1">

			</div>
			<div>
				<div class="Equipment_patrol_con1" style="margin-bottom: 0;">
					<p><span style="font-size: 0.8rem;color: #999999;">动火部位：</span><span id="dhbw"></span></p>
				</div>
				<div class="Equipment_patrol_con1 Fire_work_list" style="padding: 0 0.3rem 0 0.5rem;">
					<div class="Equipment_patrol_ccon2">
						<div class="fr_ccon2">
							<!--<p style="font-size:0.73rem;color:#757575;" class="Micro_task_pspan">
							<span><font class="fontSize" style="color: #666666;">灭火器123：</font></span>
							<span><font class="fontSize">符合</font></span>
						</p>
						<p style="font-size:0.73rem;color:#757575;" class="Micro_task_pspan">
							<span><font class="fontSize" style="color: #666666;">灭火器：</font></span>
							<span><font class="fontSize">符合</font></span>
						</p>
						<p style="font-size:0.73rem;color:#757575;" class="Micro_task_pspan">
							<span><font class="fontSize" style="color: #666666;">灭火器：</font></span>
							<span><font class="fontSize">符合</font></span>
						</p>-->
						</div>
						<div class="fr_ccon2c">
							<p class="Micro_task_1_list_img_con" id="Fire_Formally_work_2_img" style="font-size:0.73rem;color:#757575;" class="Micro_task_pspan">
								<!--<span class="Micro_task_pspan_img">
								<span   style="width:20%;" >
									<img src="images/119logo.png"  data-preview-src="" data-preview-group="1"/>
									<font style="line-height: 1rem;">标题</font>
								</span>
								</span>-->
							</p>
							<p class="Micro_task_1_list_img_con" id="Fire_Formally_work_2_video" style="font-size:0.73rem;color:#757575;" class="Micro_task_pspan">
								<!--<span class="Micro_task_pspan_img Fire_video">
								<span   style="width:20%;" >
									<img src="images/119logo.png"/>
									<font style="line-height: 1rem;">标题</font>
								</span>
								</span>-->
							</p>
							<p class="Micro_task_1_list_img_con" id="Fire_Formally_work_2_mp3" style="font-size:0.73rem;color:#757575;" class="Micro_task_pspan">
								<!--<span style="display: block;width: 100%;height: 37px;">
									<audio style="height: 47px;width:100%;" src="http://172.16.160.34:8002/uploadfiles/2017/20170725/1126/20170725112632232235.mp3"controls="controls"></audio>
								</span>-->
							</p>
						</div>
						<p style="font-size:0.73rem;color:#757575;" class="Micro_task_pspan">
							<span style="width: 40%;text-align: center;"><font>检&nbsp;查&nbsp;人：</font><font class="fontSize jiancha" id="jianName"></font></span>
							<span style="width: 60%;text-align: center;"><font>检查时间：</font><font class="fontSize shijian" id="jianDate"></font></span>
						</p>

					</div>
					<!--<div class="Equipment_patrol_ccon2">

						<p style="font-size:0.73rem;color:#757575;" class="Micro_task_pspan">
							<span><font class="fontSize">执行结果：</font><font  id="Microtask1list8">---</font></span>
							<span><font class="fontSize">执行岗位：</font><font  id="Microtask1list9">---</font></span>
						</p>
						<p style="font-size:0.73rem;color:#757575;" class="Micro_task_pspan">
							<span><font class="fontSize">执行任务说明：</font></span>
						</p>
						<p style="font-size:0.73rem;color:#757575;" class="Micro_task_pspan">
							<span><font id="Microtask1list10"></font></span>
						</p>

						<p style="font-size:0.73rem;color:#757575;" class="Micro_task_pspan">
							<span><font class="fontSize">执 行 人：</font><font  id="Microtask1list11">---</font></span>
							<span><font class="fontSize">执行时间：</font><font  id="Microtask1list12">---</font></span>
						</p>
						<p class="Micro_task_1_list_img_con" id="Microtask1list13" style="font-size:0.73rem;color:#757575;" class="Micro_task_pspan">
							<!--<span class="Micro_task_pspan_img">
								<span   style="width:20%;" >
									<img src="images/119logo.png"/>
									<font style="line-height: 1rem;">标题</font>
									<font>16:25:30</font>
								</span>
							</span>
					</p>-->
				</div>
				<div class="Equipment_patrol_ccon2 Micro_task_1_list_pingjia">
					<!--<p style="font-size:0.73rem;color:#757575;" class="Micro_task_pspan">
							<span>工作评价：<font  >---</font></span>
							<span>评论时间：<font  >---</font></span>
						</p>
						<p>备注：</p>
						<p style="color:#999999" >---</p>-->
				</div>

			</div>
		</div>
		<!--</div>-->
		<!--</div>-->
		<script src="js/mui.min.js"></script>
		<script src="js/mui.zoom.js"></script>
		<script src="js/mui.previewimage.js"></script>
		<script src="js/jquery.min.js"></script>
		<script type="text/javascript">
			mui.init();
			mui.previewImage();
			//创建子页面，首个选项卡页面显示，其它均隐藏；
			mui.plusReady(function() {
				function WebApp_GetFireWorkTask_1st() {
					var PermitIDFire = localStorage.getItem('PermitIDFire');
					var urlTask = 'http://' + localStorage.getItem("serverAddress") + ':' + localStorage.getItem("portNum") + '/WebApi/DataExchange/GetData/WebApp_GetFireWorkTask_1st?dataKey=00-00-00-00&PermitID=' + PermitIDFire;
					//										console.log(urlTask);
					mui.ajax(urlTask, {
						data: null,
						dataType: 'json', //返回
						type: 'get',
						timeout: 5000,
						success: function(data) {
							var ItemData = '';
							var getDatas = data['DataSource']['Tables'][0]['Datas'];
							var getDatas1 = data['DataSource']['Tables'][1]['Datas'];
							var htmldata = '';
							var ExamTime = [];

							var imgUrl = '';
							var imgVideo = '';
							var imgMp3 = '';

							var replaceData1 = '';
							var replaceData2 = '';
							var replaceData3 = '';

							if(!getDatas[0] || getDatas[0].ItemData.length <= 0) {
								document.getElementById("dhbw").innerHTML = localStorage.getItem('dhwz');
								document.querySelector(".Fire_work_list").innerHTML = '<p style="text-align: center;padding-top: 0.7rem;"><span style="color: #999999;font-size: 0.9rem;">暂无数据</span></p>'
								return;
							}

							document.getElementById("jianName").innerHTML = getDatas[0].UserName;
							//							document.getElementById("jianDate").innerHTML = getDatas[0].ExamTime;

							mui.each(getDatas, function(index, item) {
								ItemData += item.ItemData + ';';
								ExamTime.push(item.ExamTime);
							})

							//时间排序取最大值(冒泡排序)
							function sortarr(arr) {
								for(i = 0; i < arr.length - 1; i++) {
									for(j = 0; j < arr.length - 1 - i; j++) {
										if(arr[j] > arr[j + 1]) {
											var temp = arr[j];
											arr[j] = arr[j + 1];
											arr[j + 1] = temp;
										}
									}
								}
								return arr;
							}
							sortarr(ExamTime);
							//							console.log(ExamTime);
							document.getElementById("jianDate").innerHTML = ExamTime[ExamTime.length - 1];
							//分割数组
							var ItemDataTot = new Array();
							ItemDataTot = ItemData.split(";");
							for(i = 0; i < ItemDataTot.length - 1; i++) {
								//console.log(ItemDataTot[i])

								htmldata +=
									'<p style="font-size:0.73rem;color:#757575;" class="Micro_task_pspan">' +
									'<span><font class="fontSize" style="color: #666666;">' + ItemDataTot[i].match(/[^：]+(?=[：])/g) + '：' + '</font></span>' +
									'<span><font class="fontSize">' + ItemDataTot[i].replace(/[^：]*：([^：]*)/, "$1") + '</font></span>' +
									'</p>';
							}
							//							console.log(htmldata);
							document.querySelector(".fr_ccon2").innerHTML = htmldata;

							mui.each(getDatas1, function(index, item) {
								//							var iimg = '/uploadfiles/2017/20170725/1126/20170725112621233868.jpg';
								//							var mp4 = '/uploadfiles/2017/20170725/1126/20170725112612076717.mp4';
								//							var mp3 = '/uploadfiles/2017/20170725/1126/20170725112632232235.mp3';
								//console.log(item.Url)
								var dat = item.Url;
								var typeT = String(test(dat)).toLowerCase();

								function test(file_name) {
									var result = /\.[^\.]+/.exec(file_name);
									return result;
								}
								if(typeT == '.jpg' || typeT == '.jpeg' || typeT == '.JPEG' || typeT == '.png' || typeT == '.gif' || typeT == '.bmp' || typeT == '.tif' || typeT == '.psd') {
									imgUrl +=
										'<span  style="height: 3.5rem;" class="Micro_task_pspan_img">' +
										'<span style="width:20%;" >' +
										'<img src="' + 'http://' + localStorage.getItem("serverAddress") + ':' + localStorage.getItem("portNum") + item.Url + '"data-preview-src="" data-preview-group="1"/>' +
										'<font style="line-height: 1rem;">' + item.Title + '</font>' +
										'</span>' +
										'</span>';
									//						'<span><img src="' + 'http://' + localStorage.getItem("serverAddress") + ':' + localStorage.getItem("portNum") + item.Url + '" data-preview-src="" data-preview-group="1"/>' +
									//							'<font style="word-break:break-all;">' + item.Title + '</font>';
									//						'</span>';
								}

								if(typeT == '.mp4' || typeT == '.avi' || typeT == '.flv' || typeT == '.rmvb' || typeT == '.wmv' || typeT == '.3gp' || typeT == '.mkv' || typeT == '.mov' || typeT == '.ogg') {
									imgVideo +=
										'<span class="Micro_task_pspan_img Fire_video">' +
										'<input type="hidden" value="' + item.Url + '" />' +
										'<span style="width:20%;" >' +
										'<img  style="height: 3.5rem;" src="images/shipin.png">' +
										'<font style="line-height: 1rem;">' + item.Title + '</font>' +
										'</span>' +
										'</span>';
									//							'<span class="iconfont icon-shipin videoV">' +
									//							'<input type="hidden" value="' + item.Url + '" />' +
									//							'<font></font>' +
									//							'</span>';
								}

								if(typeT == '.mp3' || typeT == '.wma' || typeT == '.wav') {
									imgMp3 +=

										'<span style="display:block;width: 100%;height: 37px;">' +
										'<audio style="height:47px;width:100%;" src="' + 'http://' + localStorage.getItem("serverAddress") + ':' + localStorage.getItem("portNum") + item.Url + '"controls="controls"></audio>' +
										'</span>';
									//							'<span class="iconfont icon-shipin videoV">' +
									//							'<input type="hidden" value="' + item.Url + '" />' +
									//							'<font></font>' +
									//							'</span>';
									//														console.log(imgMp3)
								}
								//
								//							imgUrl +=
								//								'<span class="Micro_task_pspan_img">' +
								//								'<span   style="width:20%;" >' +
								//								'<img src="' + 'http://' + localStorage.getItem("serverAddress") + ':' + localStorage.getItem("portNum") + item.Url + '" data-preview-src="" data-preview-group="1"/>' +
								//								'<font style="line-height: 1rem;">' + item.Title + '</font>' +
								//								//									'<font>'+ item. +'</font>'+
								//								'</span>' +
								//								'</span>';
								//							//								console.log(item.Url);
							})

							if(imgUrl) {
								document.getElementById("Fire_Formally_work_2_img").innerHTML = imgUrl;
							} else {
								$('#Fire_Formally_work_2_img').remove();
							}

							if(imgVideo) {
								document.getElementById("Fire_Formally_work_2_video").innerHTML = imgVideo;
							} else {
								$('#Fire_Formally_work_2_video').remove();
							}

							if(imgMp3) {
								console.log(imgMp3)
								document.getElementById("Fire_Formally_work_2_mp3").innerHTML = imgMp3;
							} else {
								$('#Fire_Formally_work_2_mp3').remove();
							}
							document.getElementById("dhbw").innerHTML = localStorage.getItem('dhwz');
							//							document.querySelector(".jiancha").innerHTML =123;
							//							document.querySelector(".shijian").innerHTML = getDatas[0].ExamTime; 

						},
						error: function() {
							//异常处理
							mui.toast('数据请求失败')
						}
					})
				}
				WebApp_GetFireWorkTask_1st();

				//视屏播放处理
				mui('#Fire_Formally_work_2_video').on('tap', '.Fire_video', function() {
					//console.log(this.firstChild.value)
					mui.openWindow({
						url: 'Video.html',
						id: 'Video.html',
						styles: {
							top: 0, //新页面顶部位置
							bottom: 0, //新页面底部位置
						},
						extras: {
							videoUrl: this.firstChild.value,
						},
						show: {
							duration: '300'
						},
						waiting: {
							autoShow: true, //自动显示等待框，默认为true
							title: '加载中...', //等待对话框上显示的提示内容
						}
					});
				})
			});
		</script>
	</body>

</html>