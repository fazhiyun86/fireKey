<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<link rel="stylesheet" type="text/css" href="css/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="css/imageViewer.css" />
		<style>
			.mui-bar-nav~.mui-content {
				padding: 50px 0 5px 0;
			}
			
			.Micro_task_tit a {
				color: #666666;
				font-size: 0.8rem;
			}
			
			#address11 {
				width: 100%;
				text-align: left;
				/*padding: 0 0 0 1rem;*/
				margin: 0;
			}
			
			.Equipment_patrol_con_list {
				margin-top: 0.5rem;
			}
			
			.Equipment_patrol_con_list>p {
				width: 20%;
				white-space: nowrap;
			}
			
			.Equipment_patrol_con1:first-child {
				margin-top: 0.5rem;
			}
			
			.Equipment_patrol_con1 div p {
				float: left;
				/*overflow: hidden;
				text-overflow: ellipsis;*/
				white-space: initial;
				word-break: break-all;
				width: 100%;
			}
			
			.Equipment_patrol_ccon2 {
				width: 100%;
			}
			
			.Equipment_patrol_ccon2 p {
				padding-left: 0;
			}
			
			.Micro_task_pspan span:first-child {
				width: 50%;
			}
			
			.Micro_task_pspan span:nth-child(2) {
				width: 50%;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav titBackg">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">设备运维</h1>
			<!--<a class="mui-icon mui-icon-search"></a>-->
		</header>
		<div class="mui-content Equipment_patrol_con ">
			<div id="Equipment_patrol_con1">

				<div class="Equipment_patrol_con1">
					<div class="Equipment_patrol_ccon2" style="width: 100%;">
						<p class="Micro_task_pspan" style="font-size:0.7rem;color:#757575;border-bottom: 1px solid #C5C5C5;margin: 0 0 0.2rem 0;padding-bottom: 0.2rem;">
							<span style="color:#999999;">申报明细</span>
							<span>申报时间：<font id="activen1"></font></span>
						</p>

						<p style="font-size:0.7rem;color:#757575;" class="Micro_task_pspan">
							<span>申报单号：<font id="activen2"></font></span>
							<span>设备名称：<font id="activen3"></font></span>
						</p>

						<p style="font-size:0.7rem;color:#757575;" class="Micro_task_pspan">
							<span>设备型号：<font id="activen2_1"></font></span>
							<span>设备厂商：<font id="activen3_1"></font></span>
						</p>

						<p style="font-size:0.7rem;color:#757575;" class="Micro_task_pspan">
							<span>所属部门：<font id="activen4"></font></span>
							<span>设备位置：<font id="activen5"></font></span>
						</p>
						<p style="font-size:0.7rem;color:#757575;" class="Micro_task_pspan">
							<span>申报单位：<font id="activen6"></font></span>
							<span>申&nbsp;报&nbsp;人：<font id="activen7"></font></span>
						</p>
						<p style="font-size:0.7rem;color:#757575;" class="Micro_task_pspan">
							<span>故障类型：<font id="activen8"></font></span>
							<span>故障原因：<font id="activen9"></font></span>
						</p>
						<p style="font-size:0.7rem;color:#757575;">
							<span>情况说明：<font id="activen10"></font></span>
						</p>
						<p class="Micro_task_1_list_img_con" id="Microtask1list13A" style="font-size:0.73rem;color:#757575;" class="Micro_task_pspan">
							<!--<span class="Micro_task_pspan_img">
								<span   style="width:20%;" >
									<img src="images/119logo.png"/>
									<font style="line-height: 1rem;">标题</font>
								</span>
							</span>-->
						</p>
						<p class="Micro_task_1_list_img_con" id="Microtask1list13B" style="font-size:0.73rem;color:#757575;" class="Micro_task_pspan">
							<!--<span class="Micro_task_pspan" style="width:100%;display:block;">
								<audio style="height: 47px;width:100%;" src="http://172.16.160.34:8002/uploadfiles/2017/20170725/1126/20170725112632232235.mp3" controls="controls">
								</audio>
							</span>-->
						</p>
						<p class="Micro_task_1_list_img_con" id="Microtask1list13C" style="font-size:0.73rem;color:#757575;" class="Micro_task_pspan">
							<!--<span class="Micro_task_pspan_img">
								<span   style="width:20%;" >
									<img src="images/119logo.png"/>
									<font style="line-height: 1rem;">标题</font>
								</span>
							</span>-->
						</p>
					</div>
				</div>

				<div class="Equipment_patrol_con1">
					<div class="Equipment_patrol_ccon2" style="width: 100%;">
						<p class="Micro_task_pspan" style="font-size:0.7rem;color:#757575;border-bottom: 1px solid #C5C5C5;margin: 0 0 0.2rem 0;padding-bottom: 0.2rem;">
							<span style="color:#999999;">维修受理</span>
							<span>受理时间：<font id="activen11"></font></span>
						</p>
						<p style="font-size:0.7rem;color:#757575;" class="Micro_task_pspan">
							<span>受理单位：<font id="activen12"></font></span>
							<span>受理人：<font id="activen13"></font></span>
						</p>
						<p style="font-size:0.7rem;color:#757575;">
							<span>受理意见：<font id="activen14"></font></span>
						</p>

					</div>
				</div>

				<div class="Equipment_patrol_con1">
					<div class="Equipment_patrol_ccon2" style="width: 100%;">
						<p class="Micro_task_pspan" style="font-size:0.7rem;color:#757575;border-bottom: 1px solid #C5C5C5;margin: 0 0 0.2rem 0;padding-bottom: 0.2rem;">
							<span style="color:#999999;">审批信息</span>
							<span style="width: 60%;">审批时间：<font id="activen15"></font></span>
						</p>
						<p style="font-size:0.7rem;color:#757575;">
							<span>审&nbsp;批&nbsp;人：<font id="activen16"></font></span>
						</p>
						<p style="font-size:0.7rem;color:#757575;">
							<span>受理意见：<font id="activen17"></font></span>
						</p>
					</div>
				</div>

				<div class="Equipment_patrol_con1">
					<div class="Equipment_patrol_ccon2" style="width: 100%;">
						<p class="Micro_task_pspan" style="font-size:0.7rem;color:#757575;border-bottom: 1px solid #C5C5C5;margin: 0 0 0.2rem 0;padding-bottom: 0.2rem;">
							<span style="color:#999999;">派工信息</span>
							<span style="width: 60%;">派单时间：<font id="activen18"></font></span>
						</p>
						<p style="font-size:0.7rem;color:#757575;" class="Micro_task_pspan">
							<span>派工单位：<font id="activen19"></font></span>
							<span>派&nbsp;单&nbsp;人：<font id="activen20"></font></span>
						</p>
						<p style="font-size:0.7rem;color:#757575;" class="Micro_task_pspan">
							<span>维&nbsp;修&nbsp;人：<font id="activen21"></font></span>
							<span>计划维修：<font id="activen22"></font></span>
						</p>
						<p style="font-size:0.7rem;color:#757575;">
							<span>联系方式：<font id="activen23"></font></span>
						</p>
						<p style="font-size:0.7rem;color:#757575;">
							<span>派单意见：<font id="activen24"></font></span>
						</p>
					</div>
				</div>

				<div class="Equipment_patrol_con1">
					<div class="Equipment_patrol_ccon2" style="width: 100%;">
						<p class="Micro_task_pspan" style="font-size:0.7rem;color:#757575;border-bottom: 1px solid #C5C5C5;margin: 0 0 0.2rem 0;padding-bottom: 0.2rem;">
							<span style="color:#999999;">维修信息</span>
							<span style="width: 60%;">登录时间：<font id="activen25"></font></span>
						</p>
						<p style="font-size:0.7rem;color:#757575;" class="Micro_task_pspan">
							<span>维修方式：<font id="activen26"></font></span>
							<span>维修结果：<font id="activen27"></font></span>
						</p>
						<p style="font-size:0.7rem;color:#757575;" class="Micro_task_pspan">
							<span>登&nbsp;记&nbsp;人：<font id="activen28"></font></span>
							<span>更换配件：<font id="activen29"></font><button id="activen29Btn" style="height: 20px;width: 4.5rem;font-size: 0.7rem;line-height: 0;text-align: center;padding: 0;">查看配件</button></span>
						</p>
						<p style="font-size:0.7rem;color:#757575;">
							<span>维修说明：<font id="activen30"></font></span>
						</p>

					</div>
				</div>

				<div class="Equipment_patrol_con1">
					<div class="Equipment_patrol_ccon2" style="width: 100%;">
						<p class="Micro_task_pspan" style="font-size:0.7rem;color:#757575;border-bottom: 1px solid #C5C5C5;margin: 0 0 0.2rem 0;padding-bottom: 0.2rem;">
							<span style="color:#999999;">费用登记</span>
							<span style="width: 60%;">登记时间：<font id="activen31"></font></span>
						</p>
						<p style="font-size:0.7rem;color:#757575;" class="Micro_task_pspan">
							<span>配件费用：<font id="activen32"></font></span>
							<span>人工费用：<font id="activen33"></font></span>
						</p>
						<p style="font-size:0.7rem;color:#757575;" class="Micro_task_pspan">
							<span>其他费用：<font id="activen34"></font></span>
							<span>费用总计：<font id="activen35"></font></span>

						</p>
						<p style="font-size:0.7rem;color:#757575;">
							<span>登&nbsp;记&nbsp;人：<font id="activen36"></font></span>
						</p>
						<p style="font-size:0.7rem;color:#757575;">
							<span>费用说明：<font id="activen37"></font></span>
						</p>
					</div>
				</div>

				<div class="Equipment_patrol_con1">
					<div class="Equipment_patrol_ccon2" style="width: 100%;">
						<p class="Micro_task_pspan" style="font-size:0.7rem;color:#757575;border-bottom: 1px solid #C5C5C5;margin: 0 0 0.2rem 0;padding-bottom: 0.2rem;">
							<span style="color:#999999;">评价信息</span>
							<span style="width: 60%;">评价时间：<font id="activen38"></font></span>
						</p>
						<p style="font-size:0.7rem;color:#757575;" class="Micro_task_pspan">
							<span>评价结果：<font id="activen39"></font></span>
							<span>评&nbsp;价&nbsp;人：<font id="activen40"></font></span>
						</p>
						<p style="font-size:0.7rem;color:#757575;">
							<span>评价意见：<font id="activen41"></font></span>
						</p>
					</div>
				</div>

			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/mui.zoom.js"></script>
		<script src="js/mui.previewimage.js"></script>
		<script src="js/jquery.min.js"></script>
		<script type="text/javascript">
			mui.init();
			mui.previewImage();
			mui.plusReady(function() {
				var self = plus.webview.currentWebview();
				var ID = self.ID;

				function WebApp_GetFaultRepairDetail(Id) {
					var urlTask = 'http://' + localStorage.getItem("serverAddress") + ':' + localStorage.getItem("portNum") + '/WebApi/DataExchange/GetData/WebApp_GetFaultRepairDetail?dataKey=00-00-00-00&ID=' + Id;
					console.log(urlTask);
					mui.ajax(urlTask, {
						data: null,
						dataType: 'json', //返回
						type: 'get',
						timeout: 5000,
						success: function(data) {
							var getDatas = data['DataSource']['Tables'][0]['Datas'];
							var getDatas1 = data['DataSource']['Tables'][1]['Datas'];
							var PartsCost = 0;
							var LaborCost = 0;
							var OtherCost = 0;
							var costTot = 0;

							var imgUrl = '';
							var imgVideo = '';
							var imgMp3 = '';

							var RepairResult = ['未维修', '已维修'];
							if(getDatas[0].PartsCost) {
								PartsCost = getDatas[0].PartsCost;
							} else {
								PartsCost = 0;
							}

							if(getDatas[0].LaborCost) {
								LaborCost = getDatas[0].LaborCost;
							} else {
								LaborCost = 0;
							}

							if(getDatas[0].OtherCost) {
								OtherCost = getDatas[0].OtherCost;
							} else {
								OtherCost = 0;
							}

							costTot = Number(PartsCost) + Number(LaborCost) + Number(OtherCost);

							document.getElementById("activen1").innerHTML = getDatas[0].ReportTime;
							document.getElementById("activen2").innerHTML = getDatas[0].EquipmentName;
							document.getElementById("activen3").innerHTML = getDatas[0].EquipmentName;
							document.getElementById("activen2_1").innerHTML = getDatas[0].ModelName;
							document.getElementById("activen3_1").innerHTML = getDatas[0].EnterpriseName;
							document.getElementById("activen4").innerHTML = getDatas[0].EquipmentDepartmentName;
							document.getElementById("activen5").innerHTML = getDatas[0].Positions;
							document.getElementById("activen6").innerHTML = getDatas[0].ReportOrganiseUnitName;
							document.getElementById("activen7").innerHTML = getDatas[0].ReportUserName;
							document.getElementById("activen8").innerHTML = getDatas[0].FaultType;
							document.getElementById("activen9").innerHTML = getDatas[0].Reason;
							document.getElementById("activen10").innerHTML = getDatas[0].Explain;

							document.getElementById("activen11").innerHTML = getDatas[0].HandleDate;
							document.getElementById("activen12").innerHTML = getDatas[0].HandleOrganiseUnitName;
							document.getElementById("activen13").innerHTML = getDatas[0].HandleUserName;
							document.getElementById("activen14").innerHTML = getDatas[0].HandleExplain;

							document.getElementById("activen15").innerHTML = getDatas[0].AuditDate;
							document.getElementById("activen16").innerHTML = getDatas[0].AuditUserName;
							document.getElementById("activen17").innerHTML = getDatas[0].AuditExplain;

							document.getElementById("activen18").innerHTML = getDatas[0].DisPatchDate;
							document.getElementById("activen19").innerHTML = getDatas[0].DisPatchOrganiseUnitName;
							document.getElementById("activen20").innerHTML = getDatas[0].DisPatchUserName;
							document.getElementById("activen21").innerHTML = getDatas[0].RepairRegisterUserName;
							document.getElementById("activen22").innerHTML = getDatas[0].PlanRepairDate;
							document.getElementById("activen23").innerHTML = getDatas[0].Telephone;
							document.getElementById("activen24").innerHTML = getDatas[0].DisPatchExplain;

							document.getElementById("activen25").innerHTML = getDatas[0].RepairRegisterDate;
							document.getElementById("activen26").innerHTML = getDatas[0].RepairType;
							document.getElementById("activen27").innerHTML = RepairResult[getDatas[0].RepairResult];

							document.getElementById("activen28").innerHTML = getDatas[0].CostRecordUserName;
							//document.getElementById("activen29").innerHTML = getDatas[0].RepairExplain;

							document.getElementById("activen30").innerHTML = getDatas[0].RepairExplain;
							document.getElementById("activen31").innerHTML = getDatas[0].CostRecordDate;
							document.getElementById("activen32").innerHTML = getDatas[0].PartsCost;
							document.getElementById("activen33").innerHTML = getDatas[0].LaborCost;
							document.getElementById("activen34").innerHTML = getDatas[0].OtherCost;
							document.getElementById("activen35").innerHTML = costTot.toFixed(2);
							document.getElementById("activen36").innerHTML = getDatas[0].CostRecordUserName;
							document.getElementById("activen37").innerHTML = getDatas[0].CostRemark;

							document.getElementById("activen38").innerHTML = getDatas[0].AppraiseDate;
							document.getElementById("activen39").innerHTML = getDatas[0].AppraiseResult;
							document.getElementById("activen40").innerHTML = getDatas[0].AppraiseUserName;
							document.getElementById("activen41").innerHTML = getDatas[0].AppraiseExplain;

//							var mp4 = '/uploadfiles/2017/20170725/1126/20170725112612076717.mp4';
							mui.each(getDatas1, function(index, item) {
								//console.log(item.Url)
								var dat = item.Url;
								var typeT = String(test(dat)).toLowerCase();
								//								alert(typeT)

								function test(file_name) {
									var result = /\.[^\.]+/.exec(file_name);
									return result;
								}

								if(typeT == '.jpg' || typeT == '.jpeg' || typeT == '.JPEG' || typeT == '.png' || typeT == '.gif' || typeT == '.bmp' || typeT == '.tif' || typeT == '.psd') {
									imgUrl +=
										'<span class="Micro_task_pspan_img">' +
										'<span   style="width:20%;" >' +
										'<img src="' + 'http://' + localStorage.getItem("serverAddress") + ':' + localStorage.getItem("portNum") + item.Url + '" data-preview-src="" data-preview-group="1"/>' +
										'<font style="line-height: 1rem;">'+ item.Title +'</font>' +
										'</span>' +
										'</span>';
								}

								if(typeT == '.mp4' || typeT == '.avi' || typeT == '.flv' || typeT == '.rmvb' || typeT == '.wmv' || typeT == '.3gp' || typeT == '.mkv' || typeT == '.mov' || typeT == '.ogg') {
									imgVideo +=
										'<span class="Micro_task_pspan_img">' +
										'<input type="hidden" value="' + item.Url + '" />' +
										'<span   style="width:20%;" >' +
										'<img src="images/shipin.png"/>' +
										'<font style="line-height: 1rem;">'+ item.Title +'</font>' +
										'</span>' +
										'</span>';
								}

								if(typeT == '.mp3' || typeT == '.wma' || typeT == '.wav') {
									imgMp3 +=
										'<span class="Micro_task_pspan_img" style="width:98%!important;display:block;">' +
										'<audio style="height: 47px;width:100%;" src="' + 'http://' + localStorage.getItem("serverAddress") + ':' + localStorage.getItem("portNum") + item.Url + '"' + 'controls="controls">' +
										'</span>';
								}
							})

							if(imgUrl) {
								document.getElementById('Microtask1list13A').innerHTML = imgUrl;
							} else {
								$('#patrol_img').remove();
							}
							if(imgVideo) {
								document.getElementById('Microtask1list13B').innerHTML = imgVideo;

							} else {
								$('#patrol_video').remove();
							}
							if(imgMp3) {
								document.getElementById('Microtask1list13C').innerHTML = imgMp3;
							} else {
								$('#patrol_mp3').remove();

							}

						},
						error: function() {
							//异常处理
							mui.toast('数据请求失败')
						}
					});
				}
				WebApp_GetFaultRepairDetail(ID);

				document.getElementById("activen29Btn").addEventListener('tap', function() {
					//						console.log(this.firstChild.value)
					mui.openWindow({
						url: 'peijian.html',
						id: 'peijian.html',
						styles: {
							top: 0, //新页面顶部位置
							bottom: 0, //新页面底部位置
						},
						extras: {
							FaultRepairID: ID
						},
						show: {
							duration: '300'
						},
						waiting: {
							autoShow: true, //自动显示等待框，默认为true
							title: '加载中...', //等待对话框上显示的提示内容
						}
					});
				})

				//视屏播放处理
				mui('#Microtask1list13B').on('tap', '.Micro_task_pspan_img', function() {
					console.log(this.firstChild.value)
					mui.openWindow({
						url: 'Video.html',
						id: 'Video.html',
						styles: {
							top: 0, //新页面顶部位置
							bottom: 0, //新页面底部位置
						},
						extras: {
							videoUrl: this.firstChild.value,
						},
						show: {
							duration: '300'
						},
						waiting: {
							autoShow: true, //自动显示等待框，默认为true
							title: '加载中...', //等待对话框上显示的提示内容
						}
					});
				})

			})
		</script>
	</body>

</html>