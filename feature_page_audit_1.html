<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="css/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="css/feature_page_audit_1.css" />
		<style type="text/css">
			.titBackg{
				background: url("images/header_base_01.png");
    			background-size: 100%;
  				background-repeat: no-repeat;
			}
			
			.titBackg a, .mui-title{
				color: #FFFFFF;
			}
			
			.mui-content {
    			background: #F5F5F5!important;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav titBackg">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 id="zgaidx" class="mui-title">首都大酒店A栋</h1>
		</header>
		<div id="change_matter" class="mui-content change_matter" style="background-color:#FFFFFF; height: auto;">
			<!--整改内容-->
			<!--<div class="change_con">
				<!--整改位置，编号start-->
				<!--<div class="change_con_code">
					<p>16楼北侧逃生通道堵塞问题整改</p>
					<span>整改单号：EXAMR201703281488920</span>
				</div>-->
				<!--整改位置，编号end-->

				<!--整改内容通知start-->
				<!--<div class="change_con_inform">
					<h5>整改内容</h5>
					<div class="change_con_inform_case">
						<p class="case_p">16楼北侧逃生通知情况：存在异常</p>
						<p class="case_p">发现堆积有纸箱等杂物，影响通道畅通，存在安全隐患。</p>-->
						<!--<p class="case_atta">
							<a><img src="images/fujian.png" /></a><span>附件</span>
						</p>-->
						<!--<div class="change_con_inform_video">
							<dl>
								<dt></dt>
								<dd>标题</dd>
							</dl>
							<dl>
								<dt></dt>
								<dd>标题</dd>
							</dl>
							<dl>
								<dt></dt>
								<dd>标题</dd>
							</dl>
							<dl>
								<dt></dt>
								<dd>标题</dd>
							</dl>
						</div>-->

					<!--</div>-->
					<!--整改start-->
					<!--<p class="case_record">整改期限：2017年8月19日--2017年8月27日</p>
					<p class="case_record"><span>通知下发：王二狗张华</span><span>下发时间：2017年8月12日  24:23:19</span></p>-->
					<!--<div class="dv_line1"></div>
					<p class="case_record">通知签收：<span>张华标</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;签收时间：<span>2017-8-12 24:23:19</span></p>-->
					<!--整改end-->
				<!--</div>-->
				<!--整改内容通知end-->

				<!--整改上报start-->
				<!--<div class="change_con_report">
					<h5>整改内容</h5>
					<div class="change_con_report_case">
						<p class="case_p">已安排人员进行了清理，目前逃生通道畅通。</p>
						<div class="case_atta">
							<a><img src="images/fujian.png" /></a>
							<span>附件</span>
						</div>
						<div class="change_con_report_video">
							<dl>
								<dt></dt>
								<dd>标题</dd>
							</dl>
							<dl>
								<dt></dt>
								<dd>标题</dd>
							</dl>
							<dl>
								<dt></dt>
								<dd>标题</dd>
							</dl>
							<dl>
								<dt></dt>
								<dd>标题</dd>
							</dl>
						</div>

					</div>-->
					<!--整改start-->
					<!--<p class="case_record"><span class="case_record_sp">通知下发：张华标</span><span class="case_record_sp">下发时间：2017-8-12 24:23:19</span></p>
				</div>-->
					<!--整改内容上报end-->
					
					<!--审核-->
				<!--<div class="change_con_audit">		
					<legend>整改审核结论：</legend>
					<p><input type="radio" name="choose" value="">通过</p>
					<p><input type="radio" name="choose" value="" >未通过</p>
					<textarea name="txt" clos="100" rows="3" warp="virtual" placeholder="审核意见"></textarea>
					<button id="btn"><span class="btn_sub">审核确认</span></button>
				</div>					-->
				
			<!--</div>-->
		</div>
		<script src="js/jquery.min.js"></script>
		<script src="js/mui.min.js"></script>
		<script type="text/javascript">
			(function(){			
				
				var global_OrderID = '';
				
				mui(".mui-scroll-wrapper").scroll({
					bounce: false,//滚动条是否有弹力默认是true
					indicators: false, //是否显示滚动条,默认是true
				});
					
				mui.plusReady(function() {
					var selfView = plus.webview.currentWebview();
					OrderID = selfView.info.id;
//					console.log(OrderID)
//					console.log(OrderID);
					WebApp_FeatureAuditdetail(OrderID)	  				
				})
				
				function WebApp_FeatureAuditdetail(OrderID){
					
					var data = {
						OrderID: OrderID
					}
					console.log(data.OrderID)
					urlg = 'http://' + localStorage.getItem("serverAddress") + ':' + localStorage.getItem("portNum") + '/WebApi/DataExchange/GetData/TZDH_WebApp_EXAM_RectifyTaskDetail?dataKey=00-00-00-00';	
					
					mui.ajax(urlg, {
						data: data,
						dataType: 'json',
						type: 'get',
						timeout: 5000,
						success: function(data){
							console.log(JSON.stringify(data))
							data = data["DataSource"]["Tables"][0]["Datas"]
							setHtml(data);
							mui.toast('数据请求成功')
							
						},						
						error: function(){
							mui.toast('数据请求失败')
						}
					});
				};

				function setHtml(data) {
					var len = data.length;
					var html = '';
					for (var i=0; i < len; i++){
					global_OrderID = data[i].OrderID
					var item = data[i];
					var RectifyOrg = data[i]['RectifyOrg'];
					document.getElementById("zgaidx").innerHTML = RectifyOrg;
						html += '<div class="change_con">' +
							'<div class="change_con_code" style="background: #fff; border:0;">' +
							'<p>'+ item.OrderName +'</p>' +
							'<span>整改单号：'+ item.OrderCode +'</span>' +
							'</div>' +
							'<div class="change_con_inform" style="height:auto; background: #fff; border:0; padding-bottom:0.2rem;">' +
							'<h5>整改内容：</h5>' +
							'<div class="change_con_inform_case">' +
							'<p class="case_p">'+ item.RectifyContent +'</p>' +
							'</div>' +
							'<p class="case_record">整改期限：'+ item.TimeExpired +'</p>' +
							'<p class="case_record"><span>通知下发：'+ item.OrderUser +'</span><span>下发时间：'+ item.OrderDate +'</span></p>' +
							'</div>' +
							'<div class="change_con_report" style="height:6rem; background: #fff; border:0;">' +
							'<h5>整改意见：</h5>' +
							'<p class="case_record"><span class="case_record_sp"> 审  核  人 ：</span><span class="case_record_sp">审核时间：</span></p>' +
							'</div>' +
							'<div class="change_con_audit" style="background: #fff; border:0;">	' +
							'<legend>整改审核结论：</legend>' +
							'<p><input class="radio" type="radio" name="choose" value="通过">通过</p>' +
							'<p><input class="radio" type="radio" name="choose" value="未通过">未通过</p>' +
							'<textarea id="textval" name="txt" clos="100" rows="3" warp="virtual" placeholder="审核意见" value=""></textarea>' +
							'<button id="btn"><span class="btn_sub">审核确认</span></button>' +
							'</div>' +
					
							'</div>';
					}
					document.getElementById("change_matter").innerHTML = html;
				}
				
				function suBmit(){
					var data = getValue();
					console.log(data)
					
					urlg = 'http://' + localStorage.getItem("serverAddress") + ':' + localStorage.getItem("portNum") + '/WebApi/DataExchange/SendData/TZDH_WebApp_EXAM_ExamineRectify_AuditOne?dataKey=00-00-00-00';			
					mui.ajax(urlg, {
						data:data,
						dataType:'json',
						type:'post',
						timeout:5000,
						headers:{'Content-Type':'application/json'},
						success:function(data) {
							console.log(JSON.stringify(data))
							mui.toast('提交成功')
						},
						error: function(){
							mui.toast('请求失败')
						}
					});
				}
	
				function getValue () {
					var data = {}

					data.OrderID = global_OrderID;
					data.ProcAuditDescript = $('#textval').val();
					data.RectifyStatus = getRadioRes('radio');
					data.ModifiedBy = localStorage.getItem('userCodeVa');
					data.RectifyResult = resultVal();
					console.log("===="+JSON.stringify(data))
					return JSON.stringify(data);
				};

				//点击图标是否删除？
				function getVals(){
				    var res = getRadioRes('rds');
				    if(res == null){mui.toast('请选择'); return;}
				    mui.toast(res);
				};
				function getRadioRes(className){
				    var rdsObj = document.getElementsByClassName(className);
				    var checkVal = null;
				    for(i = 0; i < rdsObj.length; i++){
				        if(rdsObj[i].checked){
				        	if( rdsObj[i].value == '通过'){
				        		checkVal = 9
				        	}else if( rdsObj[i].value == '未通过'){
				        		checkVal = 10
				        	}
				        }
				    }
				    return checkVal;
				};
				
				function resultVal(){
					
					var RectifyResult = null;
					
					getRadioRes('radio');
					
					if( getRadioRes('radio') == 9 ){
						RectifyResult = 1
					}else if( getRadioRes('radio') == 10 ){
						RectifyResult = -1
					}
					return RectifyResult;
				};
				
				//	校验
				function judgment(){
					//审批意见
					var DescriptValue =  $('#textval').val();
					if( DescriptValue == '' ){
						mui.toast('通知名称不能为空');
						return
					}else{
						ProcAuditDescript = DescriptValue;
					};
					var btnArray = ['确认', '取消'];
					mui.confirm('您确认此次整改已通过审核？', '提示', btnArray, function(e) {
						if (e.index == 0) {
							location.href = 'feature_page_audit.html';
						}
					})
					suBmit();
				};
				
	  			mui("#change_matter").on('tap', '.btn_sub', function(e) {
	  				judgment();
          		});
			})();
		</script>
	</body>

</html>