<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="css/base.css" />
		<link rel="stylesheet" type="text/css" href="css/totalTarget_equipRefer.css" />
		<style>
			section>.mui-bar-nav {
				margin-top: 2%;
			}
			
			.demand {
				margin-top: 4rem;
			}
			
			.demandBtn {
				background: #E70012;
				border: 0;
			}
			
			.underline {
				border: 0!important;
			}
		</style>
	</head>

	<body>
		<section class="header-for-time-area">
			<div class="mui-bar mui-bar-nav">
				<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
				<h1 id='Scancode' class="mui-title" style="color: white;">设备查询</h1>
			</div>
		</section>
		<div class="mui-content">
			<!--<div class="smcx">扫描查询</div>
			<div class="scanContent">
				<div id="barcode" class="scan barcode">
				</div>
				<div id="dbarcode" class="scan dbarcode">
				</div>
				<div id="rfid" class="scan rfid">
				</div>
			</div>-->
			<!--<div class="scanContent">
				<div class="scanWord">条形码</div>
				<div class="scanWord">二维码</div>
				<div class="scanWord">RFID</div>
			</div>-->
			<div class="underline"></div>
			<!--<div class="referWord">手动查询</div>-->
			<div class="demand">
				<div class="equipNum">设备编号</div>
				<div class="equipContent"><input type="text" placeholder="请输入名称" id="numnum"></div>
			</div>
			<div class="demandBtn" id="check">查询</div>

		</div>
		<script src="js/mui.min.js"></script>
		<script type="text/javascript">
			mui.ready(function() {
				mui.init();
				mui('.mui-content').on('tap', '#check', function() {
					var userNum = document.getElementById("numnum").value;
					localStorage.setItem('userNumCode', userNum)
					if(userNum) {

						function WebApp_GetEquipmentStatusQuery(code) {
							var url = 'http://' + localStorage.getItem("serverAddress") + ':' + localStorage.getItem("portNum") + '/WebApi/DataExchange/GetData/WebApp_GetEquipmentStatusQuery?dataKey=00-00-00-00&Code=' + code;
							console.log(url);
							mui.ajax(url, {
								data: null,
								dataType: 'json', //返回
								type: 'get',
								timeout: 5000,
								success: function(data) {
									//服务器返回响应，根据响应结果，分析是否登陆成功
									var getDatas = data['DataSource']['Tables'][0]['Datas'];

									if(getDatas <= 0) {
										mui.toast('查无此设备');
									} else {
										mui.openWindow({
											url: 'Equipment_state_query.html',
											id: 'Equipment_state_query.html',
											styles: {
												top: 0, //新页面顶部位置
												bottom: 0, //新页面底部位置
											},
											extras: {
												code: userNum
											},
											show: {
												duration: '300'
											},
											waiting: {
												autoShow: true, //自动显示等待框，默认为true
												title: '加载中...', //等待对话框上显示的提示内容
											}
										});
									}
								},
								error: function() {
									//异常处理
									mui.toast('数据请求失败')
								}
							});
						};
						WebApp_GetEquipmentStatusQuery(userNum)

					} else {
						mui.toast('编号不能为空')
					}
				})

			})
		</script>
	</body>

</html>